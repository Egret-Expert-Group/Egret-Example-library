var Main=function(t){function e(){t.call(this),this.entityFlagNumX=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.loadGroup("TestArmature")},n.onResourceLoadComplete=function(t){"TestArmature"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this.createGameScene())},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.createGameScene=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.createMotorcycleExp()},n.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},n.createMotorcycleExp=function(){this.actionArray=["stop","run","run2","squat","oneLegStand","oneLegStand2","float","pushUp"],this.container=new egret.DisplayObjectContainer,this.addChild(this.container),this.container.x=250,this.container.y=350,this.drawText();var t=RES.getRes("skeleton_json"),e=RES.getRes("texture_json"),i=RES.getRes("texture_png"),n=new dragonBones.EgretFactory;n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(t)),n.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,e)),this.armature=n.buildArmature("Robot"),this.armatureDisplay=this.armature.getDisplay(),dragonBones.WorldClock.clock.add(this.armature),this.container.addChild(this.armatureDisplay),this.armatureDisplay.x=0,this.armatureDisplay.y=0,this.actionFlag=0,this.armature.animation.gotoAndPlay(this.actionArray[this.actionFlag]),egret.startTick(this.onTicker,this),this.myTimer=new egret.Timer(10),this.myTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)},n.onTicker=function(t){this._time||(this._time=t);var e=t,i=e-this._time;return this._time=e,dragonBones.WorldClock.clock.advanceTime(i/1e3),!1},n.onTouch=function(t){switch(t.stopPropagation(),t.type){case egret.TouchEvent.TOUCH_BEGIN:this.tapFlagNum=0,this.moveFlag=!1,this.beginPointX=t.stageX,this.beginPointY=t.stageY,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.myTimer.running||this.myTimer.start();break;case egret.TouchEvent.TOUCH_END:this.stage.hasEventListener(egret.TouchEvent.TOUCH_END)&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.endPointX=t.stageX,this.endPointY=t.stageY;var e=Math.abs(this.endPointX-this.beginPointX)>Math.abs(this.endPointY-this.beginPointY)?!0:!1;e?(this.moveFlag=!0,this.endPointX<240&&(this.endPointX=240),this.endPointX>560&&(this.endPointX=560),this.container.x-this.endPointX>4&&(this.entityFlagNumX=-2,this.container.scaleX=1),this.container.x-this.endPointX<-4&&(this.entityFlagNumX=2,this.container.scaleX=-1),"run"!=this.armature.animation.lastAnimationName&&this.armature.animation.gotoAndPlay("run"),this.myTimer.running||this.myTimer.start()):this.endPointY-this.beginPointY>0?"squat"!=this.armature.animation.lastAnimationName&&this.armature.animation.gotoAndPlay("squat"):"float"!=this.armature.animation.lastAnimationName&&this.armature.animation.gotoAndPlay("float");break;case egret.TouchEvent.TOUCH_TAP:this.myTimer.stop(),this.moveFlag=!1,this.tapFlagNum=0,this.actionFlag++,this.actionFlag==this.actionArray.length&&(this.actionFlag=0),this.armature.animation.gotoAndPlay(this.actionArray[this.actionFlag])}},n.onTimer=function(t){this.moveFlag?(Math.abs(this.container.x-this.endPointX)<4&&(this.entityFlagNumX=0),this.container.x+=this.entityFlagNumX,Math.abs(this.container.x-this.endPointX)<4&&("stop"!=this.armature.animation.lastAnimationName&&this.armature.animation.gotoAndPlay("stop"),this.myTimer.stop(),this.moveFlag=!1)):(this.tapFlagNum++,this.tapFlagNum>9&&(this.stage.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.stage.hasEventListener(egret.TouchEvent.TOUCH_END)||this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.myTimer.stop(),this.tapFlagNum=0))},n.drawText=function(){this._txInfo=new egret.TextField,this.addChild(this._txInfo),this._txInfo.size=28,this._txInfo.x=50,this._txInfo.y=50,this._txInfo.textAlign=egret.HorizontalAlign.LEFT,this._txInfo.textColor=0,this._txInfo.type=egret.TextFieldType.DYNAMIC,this._txInfo.lineSpacing=6,this._txInfo.multiline=!0,this._txInfo.text="点击屏幕切换骨骼动画动作",this._bgInfo=new egret.Shape,this.addChildAt(this._bgInfo,this.numChildren-1),this._bgInfo.x=this._txInfo.x,this._bgInfo.y=this._txInfo.y,this._bgInfo.graphics.clear(),this._bgInfo.graphics.beginFill(16777215,.5),this._bgInfo.graphics.drawRect(0,0,this._txInfo.width,this._txInfo.height),this._bgInfo.graphics.endFill()},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");